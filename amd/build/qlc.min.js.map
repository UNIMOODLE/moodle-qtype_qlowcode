{"version":3,"file":"qlc.min.js","sources":["../src/qlc.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Module javascript to place new conditions.\n *\n * @module    qlc\n * @category  Classes - autoloading\n * @copyright 2023, ISYC\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\nimport Url from 'core/url';\nimport ajax from 'core/ajax';\n\nexport const init = () => {\n    selectConfigUrlEvent();\n    selectWorkspaceEvent();\n    selectApplicationEvent();\n}\n\n/**\n * Select Qlowcode application\n */\nconst selectConfigUrlEvent = () => {\n    const selectElement = document.querySelector('[id*=\"id_configurl\"]');\n    \n    // Listen for toggled manual completion states of activities.\n    selectElement.addEventListener('change', (e) => {\n        selectConfigUrlAjax(e.target.value);\n    });\n};\n\nconst selectConfigUrlAjax = (id) => {\n    const targetId = 'id_applicationid';\n    const targetIdPageUrl = 'id_pageurl';\n    ajax.call([{\n        methodname: 'qtype_qlowcode_get_applications',\n        args: {\n            id\n        },\n    }])[0].done(function(data) {\n        clearSelect(targetId);\n        const selectTarget = document.getElementById(targetId);\n        for (var i = 0; i < data.length; i++) {\n            let option = document.createElement(\"option\");\n            option.text = data[i].name;\n            option.value = data[i].id;\n            selectTarget.add(option);\n            if(i == 0){\n                selectWorkspaceAjax(data[i].id)\n            }\n        }\n        return;\n    }).fail(function(err) {\n        clearSelect(targetId);\n        clearSelect(targetIdPageUrl);\n        console.log(err);\n        //notification.exception(new Error('Failed to load data'));\n        return;\n    });\n}\n\n/**\n * Select Qlowcode workspace\n */\nconst selectWorkspaceEvent = () => {\n    const selectElement = document.querySelector('[id*=\"id_workspaceid\"]');\n    \n    // Listen for toggled manual completion states of activities.\n    selectElement.addEventListener('change', (e) => {\n        selectWorkspaceAjax(e.target.value)\n    });\n};\n\nconst selectWorkspaceAjax = (workspaceId) => {\n    const configurl = document.getElementById('id_configurl');\n    const targetId = 'id_applicationid';\n    const targetIdPageUrl = 'id_pageurl';\n    ajax.call([{\n        methodname: 'qtype_qlowcode_get_applications',\n        args: {\n            id: configurl.value,\n            workspaceId\n        },\n    }])[0].done(function(data) {\n        clearSelect(targetId);\n        const selectTarget = document.getElementById(targetId);\n        for (var i = 0; i < data.length; i++) {\n            let option = document.createElement(\"option\");\n            option.text = data[i].name;\n            option.value = data[i].id;\n            selectTarget.add(option);\n        }\n        selectApplicationAjax(null)\n        return;\n    }).fail(function(err) {\n        clearSelect(targetId);\n        clearSelect(targetIdPageUrl);\n        console.log(err);\n        //notification.exception(new Error('Failed to load data'));\n        return;\n    });\n}\n\n/**\n * Select Qlowcode url\n */\nconst selectApplicationEvent = () => {\n    const selectElement = document.querySelector('[id*=\"id_applicationid\"]');\n    \n    // Listen for toggled manual completion states of activities.\n    selectElement.addEventListener('change', (e) => {\n        console.log('addEventListener', e.target.value);\n        selectApplicationAjax(e.target.value)\n    });\n};\n\nconst selectApplicationAjax = (applicationId) => {\n    const configurl = document.getElementById('id_configurl');\n    const targetId = 'id_pageurl';\n    ajax.call([{\n        methodname: 'qtype_qlowcode_get_pages',\n        args: {\n            id: configurl.value,\n            applicationId\n        },\n    }])[0].done(function(data) {\n        clearSelect(targetId);\n        const selectTarget = document.getElementById(targetId);\n        for (var i = 0; i < data.length; i++) {\n            let option = document.createElement(\"option\");\n            option.text = data[i].name;\n            option.value = data[i].id;\n            selectTarget.add(option);\n        }\n        return;\n    }).fail(function(err) {\n        clearSelect(targetId);\n        console.log(err);\n        //notification.exception(new Error('Failed to load data'));\n        return;\n    });\n}\n\nconst clearSelect = (id) => {\n    const selectQuestionnaire = document.getElementById(id);\n    // clear out old values\n    selectQuestionnaire.innerHTML = '';\n}"],"names":["selectConfigUrlEvent","selectWorkspaceEvent","selectApplicationEvent","document","querySelector","addEventListener","e","selectConfigUrlAjax","target","value","id","targetId","call","methodname","args","done","data","clearSelect","selectTarget","getElementById","i","length","option","createElement","text","name","add","selectWorkspaceAjax","fail","err","console","log","workspaceId","configurl","selectApplicationAjax","applicationId","innerHTML"],"mappings":";;;;;;;;sKA4BoB,KAChBA,uBACAC,uBACAC,gCAMEF,qBAAuB,KACHG,SAASC,cAAc,wBAG/BC,iBAAiB,UAAWC,IACtCC,oBAAoBD,EAAEE,OAAOC,WAI/BF,oBAAuBG,WACnBC,SAAW,iCAEZC,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAM,CACFJ,GAAAA,OAEJ,GAAGK,MAAK,SAASC,MACjBC,YAAYN,gBACNO,aAAef,SAASgB,eAAeR,cACxC,IAAIS,EAAI,EAAGA,EAAIJ,KAAKK,OAAQD,IAAK,KAC9BE,OAASnB,SAASoB,cAAc,UACpCD,OAAOE,KAAOR,KAAKI,GAAGK,KACtBH,OAAOb,MAAQO,KAAKI,GAAGV,GACvBQ,aAAaQ,IAAIJ,QACT,GAALF,GACCO,oBAAoBX,KAAKI,GAAGV,QAIrCkB,MAAK,SAASC,KACbZ,YAAYN,UACZM,YArBoB,cAsBpBa,QAAQC,IAAIF,SASd5B,qBAAuB,KACHE,SAASC,cAAc,0BAG/BC,iBAAiB,UAAWC,IACtCqB,oBAAoBrB,EAAEE,OAAOC,WAI/BkB,oBAAuBK,oBACnBC,UAAY9B,SAASgB,eAAe,gBACpCR,SAAW,iCAEZC,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAM,CACFJ,GAAIuB,UAAUxB,MACduB,YAAAA,gBAEJ,GAAGjB,MAAK,SAASC,MACjBC,YAAYN,gBACNO,aAAef,SAASgB,eAAeR,cACxC,IAAIS,EAAI,EAAGA,EAAIJ,KAAKK,OAAQD,IAAK,KAC9BE,OAASnB,SAASoB,cAAc,UACpCD,OAAOE,KAAOR,KAAKI,GAAGK,KACtBH,OAAOb,MAAQO,KAAKI,GAAGV,GACvBQ,aAAaQ,IAAIJ,QAErBY,sBAAsB,SAEvBN,MAAK,SAASC,KACbZ,YAAYN,UACZM,YApBoB,cAqBpBa,QAAQC,IAAIF,SASd3B,uBAAyB,KACLC,SAASC,cAAc,4BAG/BC,iBAAiB,UAAWC,IACtCwB,QAAQC,IAAI,mBAAoBzB,EAAEE,OAAOC,OACzCyB,sBAAsB5B,EAAEE,OAAOC,WAIjCyB,sBAAyBC,sBACrBF,UAAY9B,SAASgB,eAAe,8BAErCP,KAAK,CAAC,CACPC,WAAY,2BACZC,KAAM,CACFJ,GAAIuB,UAAUxB,MACd0B,cAAAA,kBAEJ,GAAGpB,MAAK,SAASC,MACjBC,YARa,oBASPC,aAAef,SAASgB,eATjB,kBAUR,IAAIC,EAAI,EAAGA,EAAIJ,KAAKK,OAAQD,IAAK,KAC9BE,OAASnB,SAASoB,cAAc,UACpCD,OAAOE,KAAOR,KAAKI,GAAGK,KACtBH,OAAOb,MAAQO,KAAKI,GAAGV,GACvBQ,aAAaQ,IAAIJ,YAGtBM,MAAK,SAASC,KACbZ,YAlBa,cAmBba,QAAQC,IAAIF,SAMdZ,YAAeP,KACWP,SAASgB,eAAeT,IAEhC0B,UAAY"}